<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>SLONIK TABLE ADD KEY</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:slony1-general@lists.slony.info"><LINK
REL="HOME"
TITLE="Slony-I 1.2.23 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Configuration and Action commmands"
HREF="cmds.html"><LINK
REL="PREVIOUS"
TITLE="SLONIK DROP LISTEN"
HREF="stmtdroplisten.html"><LINK
REL="NEXT"
TITLE="SLONIK CREATE SET"
HREF="stmtcreateset.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2012-02-03T00:30:07"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="5"
ALIGN="center"
VALIGN="bottom"
><SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> 1.2.23 Documentation</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="stmtdroplisten.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="stmtdroplisten.html"
>Fast Backward</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
HREF="stmtcreateset.html"
>Fast Forward</A
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
HREF="stmtcreateset.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="STMTTABLEADDKEY"
></A
>SLONIK TABLE ADD KEY</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN9521"
></A
><H2
>Name</H2
>TABLE ADD KEY&nbsp;--&nbsp; Add primary key for use by
    <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> for a table with no suitable
    key </DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN9525"
></A
><H2
>Synopsis</H2
><P
><TT
CLASS="COMMAND"
>TABLE ADD KEY (options);</TT
></P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN9528"
></A
><H2
>Description</H2
><P
>     In the <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> replication system,
     every replicated table is required to have at least one
     <TT
CLASS="COMMAND"
>UNIQUE</TT
> constraint whose columns are
     declared <TT
CLASS="COMMAND"
>NOT NULL.</TT
> Any primary key
     satisfies this requirement.
    </P
><P
>     As a last resort, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>in versions of <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> prior to
     2.0</I
></SPAN
>, this command can be used to add such an attribute
     to a table that does not have a primary key. Since this
     modification can have unwanted side effects, <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>it is
     strongly recommended that users add a unique and not null
     attribute by other means.</I
></SPAN
>
    </P
><P
> If you intend to use <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> version 2.0, you
   <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>must</I
></SPAN
> arrange for a more proper primary key.
   <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> will not provide one for you, and if you have cases of
   keys created via <TT
CLASS="COMMAND"
>TABLE ADD KEY</TT
>, you cannot
   expect <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> to function properly. </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
> NODE ID = ival </TT
></DT
><DD
><P
> Node ID of the set origin where the table will be
	added as a set member. (See <A
HREF="stmtsetaddtable.html"
>SLONIK SET ADD TABLE</A
>.)</P
></DD
><DT
><TT
CLASS="LITERAL"
> FULLY QUALIFIED NAME  = 'string' </TT
></DT
><DD
><P
> The full name of the table consisting of the schema
	and table name as the SQL expression <TT
CLASS="COMMAND"
>quote_ident(nspname)
	 || '.' || quote_ident(relname)</TT
>
	would return it.</P
></DD
></DL
></DIV
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
> There is a limitation at present; you can create a
    <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> table with no columns, as with <TT
CLASS="COMMAND"
> create table
    real_short (); </TT
>.  <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> will refuse to handle such a
    table.  This isn't presently regarded as a serious limitation, as
    we can't see there being terribly much interest in replicating
    tables that contain no application data.</P
></BLOCKQUOTE
></DIV
><DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Caution</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
> <TT
CLASS="COMMAND"
>TABLE ADD KEY</TT
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>should
    not be used</I
></SPAN
> if you can possibly avoid it.  It is
    emphatically <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
> a <A
HREF="slonyadmin.html#BESTPRACTICES"
>Best Practice</A
>. </P
><P
> The absence of a proper primary key should be a big red
    flag that the database schema is <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>broken.</I
></SPAN
> The
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>right</I
></SPAN
> way to repair this is to introduce a
    proper primary key, not to have <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> <SPAN
CLASS="QUOTE"
>"fake"</SPAN
> one
    up.</P
><P
>It is <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>not</I
></SPAN
> supported in <A
HREF="logshipping.html"
>log shipping</A
>,
    and we do not intend to add support.</P
></TD
></TR
></TABLE
></DIV
><P
> This uses <A
HREF="function.tableaddkey-text.html"
>schemadoctableaddkey( text )</A
>. </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN9578"
></A
><H2
>Example</H2
><PRE
CLASS="PROGRAMLISTING"
>     TABLE ADD KEY ( NODE ID = 1, 
     FULLY QUALIFIED NAME = 'public.history' );
    </PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN9581"
></A
><H2
> Locking Behaviour </H2
><P
> On the origin node, this will take out an exclusive lock on
    the table being modified for as long as it takes to:</P
><P
></P
><UL
><LI
><P
> Alter the table, adding the column;</P
></LI
><LI
><P
> Alter each row in the table, attaching the sequence value;</P
></LI
><LI
><P
> Adding the new unique index to the table.</P
></LI
></UL
><P
> On subscriber nodes, these alterations take place on the
    table when it is empty, and do not add any particular additional
    burden to subscription time where the table will be locked on the
    subscriber node.</P
><P
> If the table is large and frequently updated, by your
    applications, this will impose a not-insignificant application
    outage for the duration of the time it takes to modify the table
    on the origin node.  That is why it is recommended that this
    command should not be used if you can possibly avoid it.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN9593"
></A
><H2
> Version Information </H2
><P
> This command was introduced in <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> 1.0 </P
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
> This command is <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
> no longer supported </I
></SPAN
>
    as of <SPAN
CLASS="PRODUCTNAME"
>Slony-I</SPAN
> version 2.0.  In version 2, the various
    <SPAN
CLASS="QUOTE"
>"catalogue breakages"</SPAN
> done in <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> versions
    prior to 8.3 are being eliminated so that schema dumps may be
    taken from any node.  That leaves the <SPAN
CLASS="QUOTE"
>"kludgy"</SPAN
>
    columns created via <TT
CLASS="COMMAND"
>TABLE ADD KEY</TT
> as the only
    thing that prevents <A
HREF="stmtuninstallnode.html"
>SLONIK UNINSTALL NODE</A
> from being
    comprised of the SQL statement <TT
CLASS="COMMAND"
>drop schema _ClusterName
    cascade;</TT
>.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="stmtdroplisten.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="stmtcreateset.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>SLONIK DROP LISTEN</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="cmds.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>SLONIK CREATE SET</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>